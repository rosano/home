<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

{{ if (and (eq hugo.Environment "production") site.Params.touchURL) }}
	<link rel="icon" href="{{ site.Params.touchURL }}" type="image/png">
{{ end }}

{{- $section := cond (in (slice "timeline" "timeline_year" "timeline_month" "timeline_day" "categories" "tags" "series" "place" "country") .Section) "timeline" (cond (in (slice "lyrics_collection" "lyrics_topic") .Section) "lyrics" .Section) -}}

{{- .Scratch.Set "kSemanticSection" $section -}}
{{- .Scratch.Set "kIsHeadTitle" "true" -}}
<title>{{- partial "page-title.html" . -}}</title>
{{- if .Params.summary }}
<meta name="description" content="{{ .Summary }}" />
{{ end }}

{{- range .AlternativeOutputFormats -}}
  <link rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink | safeURL }}" title="{{- partial "page-title.html" page -}}">
{{ end -}}
{{- .Scratch.Delete "kIsHeadTitle" -}}

{{- range $k, $v := site.Params.RSSFeedURLs }}
	<link rel="alternate" type="application/rss+xml" href="{{ $v }}" title="{{ $k }}">
{{ end }}

{{- $options := (dict "outputStyle" "compressed" "enableSourceMap" true) -}}
{{- $style := slice (resources.Get "css/normalize.css/normalize.css") (resources.Get "css/OLSKDecor/ui-style.css") (resources.Get "css/ui-style.css") (resources.Get "css/style.css") | resources.Concat "css/bundle.css" | css.Sass $options -}}
<link rel="stylesheet" href="{{ $style.Permalink }}" />

{{ $js := slice (resources.Get "js/OLSKEmbed/main.js") (resources.Get "js/OLSKDOM/main.js") | resources.Concat "js/bundle.js" -}}
<script src="{{ $js.RelPermalink }}"></script>

{{ if (and (eq hugo.Environment "production") site.Params._bannerScriptURL) }}
	<script src="{{ site.Params._bannerScriptURL }}"></script>
{{ end }}

{{- partial "media-embeds.html" . -}}

</head>

<body class="{{ $section }}{{ cond (eq .Kind "page") " single" "" }}{{ with .Section }} {{ . }}{{ end }}">

<header>
	<h2>
		{{ if (and (eq hugo.Environment "production") site.Params.logoURL) }}
			<a aria-hidden="true" href="{{ site.Home.RelPermalink }}">
				<img src="{{ site.Params.logoURL }}" />
			</a>
		{{ end }}
		
		<a href="{{ site.Home.RelPermalink }}">{{ site.Title }}</a>
		{{ if (and (not .IsHome) (ne .Kind "404") (ne $section "gift")) }} / 
			{{ $sectionPage := .CurrentSection }}

			{{ if eq $section "timeline" }}
				{{ range site.Sections }}
					{{ if eq .Page.Title "Journal" }}
						{{ $sectionPage = .Page }}
					{{ end }}
				{{ end }}
			{{ end }}
			
			{{ if eq $section "lyrics" }}
				{{ range site.Sections }}
					{{ if eq .Page.Title "Lyrics" }}
						{{ $sectionPage = .Page }}
					{{ end }}
				{{ end }}
			{{ end }}
			
			<a href="{{ with $sectionPage }}{{ .Permalink }}{{ end }}">{{ with $sectionPage }}{{ .Title }}{{ end }}</a>
		{{- end }}
	</h2>
</header>

{{- block "main" . }}{{- end }}

<footer>
{{ .Render "footer" }}

{{ if or (eq $section "timeline") (and .IsPage (ne .Section "occasion")) }}
	{{- partial "timeline-footer.html" . -}}
{{ end }}
</footer>

{{ if and (eq hugo.Environment "production") site.Params._showGazette (ne .Path "/occasion") }}
	<script src="https://pkg.rosano.ca/gazette/master/main.js" data-gazette></script>
{{ end }}

{{ .Scratch.Delete "kSemanticSection" }}

</body>
</html>
